{"componentChunkName":"component---src-templates-post-post-jsx","path":"/blog/getting-started-with-diffable-data-source","result":{"data":{"markdownRemark":{"html":"<p>Diffable Data Source is a new declarative API for <code class=\"language-text\">UITableView</code> and its counterpart <code class=\"language-text\">UICollectionView</code> introduced at WWDC19, IOS 13 as a replacement for <code class=\"language-text\">UITableViewDataSource</code> and <code class=\"language-text\">UICollectionViewDataSource</code>. </p>\n<p>In this article we will take a brief look at <code class=\"language-text\">UITableViewDataSource</code> then we will go directly to the new API and see how it works with an example. </p>\n<h3>UITableViewDataSource</h3>\n<p>Previously, when working with <code class=\"language-text\">UITableView</code> or <code class=\"language-text\">UICollectionView</code> you would implement <code class=\"language-text\">UITableViewDataSource</code> protocol providing the table view with the details of how to display cells and supplementary views ( headers and footers ) and what data you want to render.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token comment\">// Providing number of Rows and Sections</span>\n<span class=\"token keyword\">func</span> <span class=\"token function\">tableView</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">UITableView</span><span class=\"token punctuation\">,</span> numberOfRowsInSection<span class=\"token punctuation\">:</span> <span class=\"token builtin\">Int</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">Int</span>\n<span class=\"token keyword\">func</span> <span class=\"token function\">numberOfSections</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">in</span><span class=\"token punctuation\">:</span> <span class=\"token builtin\">UITableView</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">Int</span>\n<span class=\"token comment\">// Providing Cells, Headers, and Footers</span>\n<span class=\"token keyword\">func</span> <span class=\"token function\">tableView</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">UITableView</span><span class=\"token punctuation\">,</span> cellForRowAt<span class=\"token punctuation\">:</span> <span class=\"token builtin\">IndexPath</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">UITableViewCell</span>\n<span class=\"token keyword\">func</span> <span class=\"token function\">tableView</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">UITableView</span><span class=\"token punctuation\">,</span> titleForHeaderInSection<span class=\"token punctuation\">:</span> <span class=\"token builtin\">Int</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">String</span><span class=\"token operator\">?</span>\n<span class=\"token keyword\">func</span> <span class=\"token function\">tableView</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">UITableView</span><span class=\"token punctuation\">,</span> titleForFooterInSection<span class=\"token punctuation\">:</span> <span class=\"token builtin\">Int</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">String</span><span class=\"token operator\">?</span>\n<span class=\"token comment\">// other datasource methods</span></code></pre></div>\n<p>whenever the models managed by the controller changes, you would normally reload the whole table view with <code class=\"language-text\">reloadData()</code> or <code class=\"language-text\">performBatchUpdates(_:completion:)</code> to update (insert, delete, move) only specific items or sections, doing something like : </p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>tableView<span class=\"token punctuation\">.</span><span class=\"token function\">performBatchUpdates</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>tableView<span class=\"token punctuation\">.</span><span class=\"token function\">deleteRows</span><span class=\"token punctuation\">(</span>at<span class=\"token punctuation\">:</span> deletedIndexPaths<span class=\"token punctuation\">,</span> with<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">.</span>fade<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>tableView<span class=\"token punctuation\">.</span><span class=\"token function\">insertRows</span><span class=\"token punctuation\">(</span>at<span class=\"token punctuation\">:</span> insertedIndexPaths<span class=\"token punctuation\">,</span> with<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">.</span><span class=\"token keyword\">right</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> completion<span class=\"token punctuation\">:</span> <span class=\"token constant\">nil</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>But you need to be careful when getting the changes occurred and make sure the changes applied in the right order.\nOtherwise when updates go wrong, you will get something like:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1000px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 17.200000000000003%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAoElEQVQI1zWOaw6CQAyEuYFGBSKKy2tZ1meiRjQmKCDK/S80tkV/TNqmX2fqhEmFfNPB7nukRQu9fonM9o2MKu9U9kCx+0if2lZ2zNhDj0g/5c5bXjHxz3DCtBIgzmtaNEhM8zPuEJtaJEdktCKWQ5iJhG+l1xQUqDvcRQknIRNOU/8j+oYhDpjOL5gFgxjm2Q9vUnl2g3KopLF3wsg94gt2FVpSXeV8PwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"wrong updates\"\n        title=\"wrong updates\"\n        src=\"/static/d973314db1ea236c7d98b20c427b07f5/332ff/wrong_updates.png\"\n        srcset=\"/static/d973314db1ea236c7d98b20c427b07f5/3e256/wrong_updates.png 250w,\n/static/d973314db1ea236c7d98b20c427b07f5/b30f8/wrong_updates.png 500w,\n/static/d973314db1ea236c7d98b20c427b07f5/332ff/wrong_updates.png 1000w,\n/static/d973314db1ea236c7d98b20c427b07f5/de2df/wrong_updates.png 1500w,\n/static/d973314db1ea236c7d98b20c427b07f5/013fe/wrong_updates.png 1714w\"\n        sizes=\"(max-width: 1000px) 100vw, 1000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<blockquote>\n<p>Although <code class=\"language-text\">UITableViewDataSource</code> approach is simple and flexible but it is also error prone and a common source of bugs and crashes when there is misalignment between the current UI state and the models managed by the controller. </p>\n</blockquote>\n<h3>Diffable data source</h3>\n<p>Now with the <code class=\"language-text\">UITableViewDiffableDataSource</code> you can create datasource and apply the changes between states in more safe way in terms of snapshots that represent the current state ( rendered models ) of the table view.\nTo display or update the the data you just create an object of <code class=\"language-text\">NSDiffableDataSourceSnapshot</code> with the updated data and provide it to the data source through calling its <code class=\"language-text\">apply(_:animatingDifferences:)</code> method that will compare the current displayed snapshot ( rendered models ) with the new applied snapshot to get the differences then apply and animate those changes.</p>\n<h2>Getting Started</h2>\n<p>Now let's see an example of a contacts list screen with a search bar allowing the user to search his contacts by name.</p>\n<p>As we mentioned, with the new approach we just need two types</p>\n<ul>\n<li><code class=\"language-text\">UITableViewDiffableDataSource</code> that has two generic types: Section type and item type, telling the table view how to display cells and supplementary views.</li>\n<li><code class=\"language-text\">NSDiffableDataSourceSnapshot&lt;SectionIdentifierType, ItemIdentifierType&gt;</code> : that represent a new or updated UI state  to be displayed.</li>\n</ul>\n<h3>Create the model</h3>\n<p>Let's start by building our model which is a Contact that will be displayed in a table view cell.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">struct</span> <span class=\"token builtin\">Contact</span> <span class=\"token punctuation\">:</span> <span class=\"token builtin\">Hashable</span> <span class=\"token punctuation\">{</span>\n  \n  <span class=\"token keyword\">var</span> id <span class=\"token operator\">=</span> <span class=\"token function\">UUID</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">var</span> firstName<span class=\"token punctuation\">:</span> <span class=\"token builtin\">String</span>\n  <span class=\"token keyword\">var</span> lastName<span class=\"token punctuation\">:</span> <span class=\"token builtin\">String</span>\n  <span class=\"token keyword\">var</span> emailAddress<span class=\"token punctuation\">:</span> <span class=\"token builtin\">String</span>\n\n  <span class=\"token keyword\">func</span> <span class=\"token function\">hash</span><span class=\"token punctuation\">(</span>into hasher<span class=\"token punctuation\">:</span> <span class=\"token keyword\">inout</span> <span class=\"token builtin\">Hasher</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    hasher<span class=\"token punctuation\">.</span><span class=\"token function\">combine</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n  \n  <span class=\"token keyword\">static</span> <span class=\"token keyword\">func</span> <span class=\"token operator\">==</span> <span class=\"token punctuation\">(</span>lhs<span class=\"token punctuation\">:</span> <span class=\"token builtin\">Contact</span><span class=\"token punctuation\">,</span> rhs<span class=\"token punctuation\">:</span> <span class=\"token builtin\">Contact</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">Bool</span> <span class=\"token punctuation\">{</span>\n    lhs<span class=\"token punctuation\">.</span>id <span class=\"token operator\">==</span> rhs<span class=\"token punctuation\">.</span>id\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<blockquote>\n<p>Note : Diffable data source requires the two generic types <code class=\"language-text\">SectionIdentifierType</code> and <code class=\"language-text\">ItemIdentifierType</code> ( model ) to be Hashable, allowing the data source to perform diffing between different snapshots ( compare different UI States to know exactly what has been inserted, deleted or moved )</p>\n</blockquote>\n<h3>Setting up the data source</h3>\n<p>First let's create our Section type that will be used as SectionIdentifierType, containing two sections:</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">enum</span> <span class=\"token builtin\">Section</span> <span class=\"token punctuation\">:</span> <span class=\"token builtin\">Int</span> <span class=\"token punctuation\">,</span> <span class=\"token builtin\">CaseIterable</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">case</span> friendsContacts\n    <span class=\"token keyword\">case</span> allContacts\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Then we create and configure our diffable data source that will provide that table view with details of how to display cells and supplementary view ( section headers and footers ).</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">typealias</span> <span class=\"token builtin\">DataSource</span> <span class=\"token operator\">=</span> <span class=\"token builtin\">UITableViewDiffableDataSource</span><span class=\"token operator\">&lt;</span><span class=\"token builtin\">Section</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">Contact</span><span class=\"token operator\">></span>\n<span class=\"token keyword\">private</span> <span class=\"token keyword\">lazy</span> <span class=\"token keyword\">var</span> dataSource <span class=\"token operator\">=</span> <span class=\"token function\">makeDataSource</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\">// ...</span>\n<span class=\"token keyword\">func</span> <span class=\"token function\">makeDataSource</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">DataSource</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> dataSource <span class=\"token operator\">=</span> <span class=\"token function\">DataSource</span><span class=\"token punctuation\">(</span>tableView<span class=\"token punctuation\">:</span> tableView<span class=\"token punctuation\">,</span> cellProvider<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span> tableView<span class=\"token punctuation\">,</span> indexPath<span class=\"token punctuation\">,</span> contact<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">UITableViewCell</span><span class=\"token operator\">?</span> <span class=\"token keyword\">in</span>\n\n        <span class=\"token keyword\">let</span> cell <span class=\"token operator\">=</span> tableView<span class=\"token punctuation\">.</span><span class=\"token function\">dequeueReusableCell</span><span class=\"token punctuation\">(</span>withIdentifier<span class=\"token punctuation\">:</span> <span class=\"token builtin\">ContactTableCell</span><span class=\"token punctuation\">.</span>reuseIdentifier<span class=\"token punctuation\">,</span> <span class=\"token keyword\">for</span><span class=\"token punctuation\">:</span> indexPath<span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span><span class=\"token operator\">?</span> <span class=\"token builtin\">ContactTableCell</span>\n        cell<span class=\"token operator\">?</span><span class=\"token punctuation\">.</span><span class=\"token function\">configure</span><span class=\"token punctuation\">(</span>with<span class=\"token punctuation\">:</span> contact<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span> cell\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> dataSource\n<span class=\"token punctuation\">}</span></code></pre></div>\n<blockquote>\n<p>Note : That you would normally do by implementing <code class=\"language-text\">cellForRowAt</code>, <code class=\"language-text\">titleForHeaderInSection</code> and so on with the <code class=\"language-text\">UITableViewDataSource</code></p>\n</blockquote>\n<h3>Creating a Snapshot</h3>\n<p>Now the table view knows exactly how to display data (models) and at this point we need to provide the table view with the data to be displayed.\nThis is where the <code class=\"language-text\">NSDiffableDataSourceSnapshot</code> comes in.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">private</span> <span class=\"token keyword\">var</span> friendsContacts <span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token builtin\">Contact</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token builtin\">Contact</span><span class=\"token punctuation\">.</span>friendsContacts\n<span class=\"token keyword\">private</span> <span class=\"token keyword\">var</span> allContacts <span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token builtin\">Contact</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token builtin\">Contact</span><span class=\"token punctuation\">.</span>allContacts\n<span class=\"token keyword\">typealias</span> <span class=\"token builtin\">Snapshot</span> <span class=\"token operator\">=</span> <span class=\"token builtin\">NSDiffableDataSourceSnapshot</span><span class=\"token operator\">&lt;</span><span class=\"token builtin\">Section</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">Contact</span><span class=\"token operator\">></span>\n\n<span class=\"token keyword\">override</span> <span class=\"token keyword\">func</span> <span class=\"token function\">viewDidLoad</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">viewDidLoad</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token comment\">// some other UI Configurations</span>\n    <span class=\"token function\">applySnapshot</span><span class=\"token punctuation\">(</span>animatingDifferences<span class=\"token punctuation\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">func</span> <span class=\"token function\">applySnapshot</span><span class=\"token punctuation\">(</span>animatingDifferences<span class=\"token punctuation\">:</span> <span class=\"token builtin\">Bool</span> <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> snapshot <span class=\"token operator\">=</span> <span class=\"token function\">Snapshot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    snapshot<span class=\"token punctuation\">.</span><span class=\"token function\">appendSections</span><span class=\"token punctuation\">(</span> <span class=\"token builtin\">Section</span><span class=\"token punctuation\">.</span>allCases <span class=\"token punctuation\">)</span>\n    snapshot<span class=\"token punctuation\">.</span><span class=\"token function\">appendItems</span><span class=\"token punctuation\">(</span>friendsContacts<span class=\"token punctuation\">,</span> toSection<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">.</span>friendsContacts<span class=\"token punctuation\">)</span>\n    snapshot<span class=\"token punctuation\">.</span><span class=\"token function\">appendItems</span><span class=\"token punctuation\">(</span>allContacts<span class=\"token punctuation\">,</span> toSection<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">.</span>allContacts<span class=\"token punctuation\">)</span>\n    dataSource<span class=\"token punctuation\">.</span><span class=\"token function\">apply</span><span class=\"token punctuation\">(</span>snapshot<span class=\"token punctuation\">,</span> animatingDifferences<span class=\"token punctuation\">:</span> animatingDifferences<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Creating a new snapshot with sections and items to be displayed. Whenever we apply a new snapshot, the table view will compare the currently displayed snapshot with the new applied one, to know exactly what's updated then apply and animate those updates accordingly.</p>\n<blockquote>\n<p>Note : You can safely call <code class=\"language-text\">apply()</code> from the main queue or a background queue.</p>\n</blockquote>\n<h3>Add UISearchController</h3>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">private</span> <span class=\"token keyword\">var</span> friendsContacts <span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token builtin\">Contact</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token builtin\">Contact</span><span class=\"token punctuation\">.</span>friendsContacts\n<span class=\"token keyword\">private</span> <span class=\"token keyword\">var</span> allContacts <span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token builtin\">Contact</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token builtin\">Contact</span><span class=\"token punctuation\">.</span>allContacts\n<span class=\"token keyword\">private</span> <span class=\"token keyword\">var</span> searchController <span class=\"token operator\">=</span> <span class=\"token function\">UISearchController</span><span class=\"token punctuation\">(</span>searchResultsController<span class=\"token punctuation\">:</span> <span class=\"token constant\">nil</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">override</span> <span class=\"token keyword\">func</span> <span class=\"token function\">viewDidLoad</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">viewDidLoad</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token comment\">// some other UI Configurations</span>\n    <span class=\"token function\">configureSearchController</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">extension</span> <span class=\"token builtin\">ContactsTableViewController</span><span class=\"token punctuation\">:</span> <span class=\"token builtin\">UISearchResultsUpdating</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">func</span> <span class=\"token function\">configureSearchController</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        searchController<span class=\"token punctuation\">.</span>searchResultsUpdater <span class=\"token operator\">=</span> <span class=\"token keyword\">self</span>\n        searchController<span class=\"token punctuation\">.</span>obscuresBackgroundDuringPresentation <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span>\n        searchController<span class=\"token punctuation\">.</span>searchBar<span class=\"token punctuation\">.</span>placeholder <span class=\"token operator\">=</span> <span class=\"token string\">\"Search Contacts\"</span>\n        navigationItem<span class=\"token punctuation\">.</span>searchController <span class=\"token operator\">=</span> searchController\n        definesPresentationContext <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">func</span> <span class=\"token function\">updateSearchResults</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">for</span> searchController<span class=\"token punctuation\">:</span> <span class=\"token builtin\">UISearchController</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n        <span class=\"token keyword\">let</span> myContacts <span class=\"token operator\">=</span> <span class=\"token builtin\">Contact</span><span class=\"token punctuation\">.</span>allContacts\n        <span class=\"token keyword\">let</span> myFriends <span class=\"token operator\">=</span> <span class=\"token builtin\">Contact</span><span class=\"token punctuation\">.</span>friendsContacts\n        <span class=\"token keyword\">if</span> <span class=\"token keyword\">let</span> text <span class=\"token operator\">=</span> searchController<span class=\"token punctuation\">.</span>searchBar<span class=\"token punctuation\">.</span>text<span class=\"token punctuation\">,</span> <span class=\"token operator\">!</span>text<span class=\"token punctuation\">.</span><span class=\"token builtin\">isEmpty</span> <span class=\"token punctuation\">{</span>\n            allContacts <span class=\"token operator\">=</span> myContacts<span class=\"token punctuation\">.</span><span class=\"token builtin\">filter</span> <span class=\"token punctuation\">{</span> contact <span class=\"token keyword\">in</span>\n                <span class=\"token keyword\">return</span> contact<span class=\"token punctuation\">.</span>firstName<span class=\"token punctuation\">.</span><span class=\"token function\">contains</span><span class=\"token punctuation\">(</span>text<span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> contact<span class=\"token punctuation\">.</span>lastName<span class=\"token punctuation\">.</span><span class=\"token function\">contains</span><span class=\"token punctuation\">(</span>text<span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">}</span>\n            friendsContacts <span class=\"token operator\">=</span> myFriends<span class=\"token punctuation\">.</span><span class=\"token builtin\">filter</span> <span class=\"token punctuation\">{</span> contact <span class=\"token keyword\">in</span>\n                <span class=\"token keyword\">return</span> contact<span class=\"token punctuation\">.</span>firstName<span class=\"token punctuation\">.</span><span class=\"token function\">contains</span><span class=\"token punctuation\">(</span>text<span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> contact<span class=\"token punctuation\">.</span>lastName<span class=\"token punctuation\">.</span><span class=\"token function\">contains</span><span class=\"token punctuation\">(</span>text<span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n            allContacts <span class=\"token operator\">=</span> myContacts\n            friendsContacts <span class=\"token operator\">=</span> myFriends\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token function\">applySnapshot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Whenever the user changes the search text, we updates our <code class=\"language-text\">allContacts</code> and <code class=\"language-text\">friendsContacts</code> lists accordingly then apply a new snapshot with the updated lists to be displayed, that's it.</p>\n<blockquote>\n<p>Note : what we are doing here is creating new snapshot from scratch then we apply it to the datasource.\nOther-way we can get the currently displayed snapshot by calling <code class=\"language-text\">dataSource.snapshot()</code> then we can update that snapshot ( insert, remove, move ) and apply it back.</p>\n</blockquote>\n<h3>Supplementary Views</h3>\n<p>Let's finally add a header to both sections.\nAssuming we need a custom header view.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">SectionHeaderReusableView</span><span class=\"token punctuation\">:</span> <span class=\"token builtin\">UITableViewHeaderFooterView</span> <span class=\"token punctuation\">{</span>\n   <span class=\"token comment\">// whatever how it looks</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Then we implement UITableViewDelegate needed methods, such as:</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token comment\">// MARK: - UITableViewDelegate</span>\n\n<span class=\"token keyword\">extension</span> <span class=\"token builtin\">ContactsTableViewController</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">func</span> <span class=\"token function\">tableView</span><span class=\"token punctuation\">(</span><span class=\"token number\">_</span> tableView<span class=\"token punctuation\">:</span> <span class=\"token builtin\">UITableView</span><span class=\"token punctuation\">,</span> heightForHeaderInSection section<span class=\"token punctuation\">:</span> <span class=\"token builtin\">Int</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">CGFloat</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token number\">30</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">func</span> <span class=\"token function\">tableView</span><span class=\"token punctuation\">(</span><span class=\"token number\">_</span> tableView<span class=\"token punctuation\">:</span> <span class=\"token builtin\">UITableView</span><span class=\"token punctuation\">,</span> heightForFooterInSection section<span class=\"token punctuation\">:</span> <span class=\"token builtin\">Int</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">CGFloat</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token builtin\">CGFloat</span><span class=\"token punctuation\">.</span>leastNormalMagnitude\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">func</span> <span class=\"token function\">tableView</span><span class=\"token punctuation\">(</span><span class=\"token number\">_</span> tableView<span class=\"token punctuation\">:</span> <span class=\"token builtin\">UITableView</span><span class=\"token punctuation\">,</span> viewForHeaderInSection section<span class=\"token punctuation\">:</span> <span class=\"token builtin\">Int</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">UIView</span><span class=\"token operator\">?</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">guard</span> <span class=\"token keyword\">let</span> header <span class=\"token operator\">=</span> tableView<span class=\"token punctuation\">.</span><span class=\"token function\">dequeueReusableHeaderFooterView</span><span class=\"token punctuation\">(</span>\n            withIdentifier<span class=\"token punctuation\">:</span> <span class=\"token builtin\">SectionHeaderReusableView</span><span class=\"token punctuation\">.</span>reuseIdentifier<span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span><span class=\"token operator\">?</span> <span class=\"token builtin\">SectionHeaderReusableView</span>\n        <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> <span class=\"token constant\">nil</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">if</span> section <span class=\"token operator\">==</span> <span class=\"token builtin\">Section</span><span class=\"token punctuation\">.</span>allContacts<span class=\"token punctuation\">.</span>rawValue <span class=\"token punctuation\">{</span>\n            header<span class=\"token punctuation\">.</span>titleLabel<span class=\"token punctuation\">.</span>text <span class=\"token operator\">=</span> <span class=\"token string\">\"Your Contacts\"</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n            header<span class=\"token punctuation\">.</span>titleLabel<span class=\"token punctuation\">.</span>text <span class=\"token operator\">=</span> <span class=\"token string\">\"Friends Contacts\"</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">return</span> header\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">func</span> <span class=\"token function\">tableView</span><span class=\"token punctuation\">(</span><span class=\"token number\">_</span> tableView<span class=\"token punctuation\">:</span> <span class=\"token builtin\">UITableView</span><span class=\"token punctuation\">,</span> viewForFooterInSection section<span class=\"token punctuation\">:</span> <span class=\"token builtin\">Int</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">UIView</span><span class=\"token operator\">?</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token constant\">nil</span>\n    <span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">}</span></code></pre></div>\n<blockquote>\n<p>Note : If you want to use <code class=\"language-text\">titleForHeaderInSection</code> and <code class=\"language-text\">titleForFooterInSection</code> both part of <code class=\"language-text\">UITableViewDataSource</code>, you can simply create <code class=\"language-text\">UITableViewDiffableDataSource</code> subclass and override the methods of you want to implement. </p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">MyDataSource</span><span class=\"token punctuation\">:</span> <span class=\"token builtin\">UITableViewDiffableDataSource</span><span class=\"token operator\">&lt;</span><span class=\"token builtin\">Section</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">Contact</span><span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">override</span> <span class=\"token keyword\">func</span> <span class=\"token function\">tableView</span><span class=\"token punctuation\">(</span><span class=\"token number\">_</span> tableView<span class=\"token punctuation\">:</span> <span class=\"token builtin\">UITableView</span><span class=\"token punctuation\">,</span> titleForHeaderInSection section<span class=\"token punctuation\">:</span> <span class=\"token builtin\">Int</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">String</span><span class=\"token operator\">?</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token string\">\"This is section: <span class=\"token interpolation\"><span class=\"token delimiter variable\">\\(</span>section<span class=\"token delimiter variable\">)</span></span>\"</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3>Final Result and Source Code</h3>\n<p>You can find the demo source code <a href=\"https://github.com/Ahmed-Komsan/DiffableDataSourceDemo\" target=\"_blank\" rel=\"nofollow\">here</a></p>\n<h3>See Also</h3>\n<ul>\n<li><a href=\"https://developer.apple.com/videos/play/wwdc2019/220/\" target=\"_blank\" rel=\"nofollow\">Advances in UI Data Sources - WWDC 2019</a></li>\n<li><a href=\"https://www.donnywals.com/modern-table-views-with-diffable-data-sources/\" target=\"_blank\" rel=\"nofollow\">Modern table views with diffable data sources</a></li>\n</ul>\n<h3>Conclusion</h3>\n<p>As you can see, Diffable Data Source makes it much easier to work with <code class=\"language-text\">UITableView</code> and <code class=\"language-text\">UICollectionView</code> by hiding most of the complexity related to synchronization between the UI State and the datasource.</p>\n<p>If you think i missed anything, let me know and feel free to share with me any thoughts or feedback you have.</p>\n<p>Thanks for reading!🚀🌌</p>","timeToRead":7,"frontmatter":{"title":"Getting Started with Diffable Data Source","date":"17 Jul 2020","tags":["Swift","UIKit","IOS"],"path":"blog/getting-started-with-diffable-data-source","excerpt":"Diffable Data Source is a new declarative API for UITableView and its counterpart UICollectionView introduced at WWDC19, IOS 13 as a replacement for UITableViewDataSource and UICollectionViewDataSource.","cover":{"childImageSharp":{"fluid":{"tracedSVG":"data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='400'%20height='167'%20viewBox='0%200%20400%20167'%20preserveAspectRatio='none'%3e%3cpath%20d='M109%2021L13%2098%200%20109v11l17-14A126111%20126111%200%2001144%201c1-1%201-1-5-1h-5l-25%2021m272%205L258%20163l-3%204h48l8-10a2005%202005%200%200066-79%20272%20272%200%200020-24l3-3V5l-19%2021'%20fill='%23d3d3d3'%20fill-rule='evenodd'/%3e%3c/svg%3e","aspectRatio":2.4038461538461537,"src":"/static/4e4efdad88ff4607d90485cba60d3758/31987/diffable1.png","srcSet":"/static/4e4efdad88ff4607d90485cba60d3758/e1953/diffable1.png 250w,\n/static/4e4efdad88ff4607d90485cba60d3758/46604/diffable1.png 500w,\n/static/4e4efdad88ff4607d90485cba60d3758/31987/diffable1.png 1000w,\n/static/4e4efdad88ff4607d90485cba60d3758/f3583/diffable1.png 1200w","sizes":"(max-width: 1000px) 100vw, 1000px"}}}}},"allMarkdownRemark":{"edges":[]}},"pageContext":{"postPath":"blog/getting-started-with-diffable-data-source","translations":[{"hreflang":"en","path":"/blog/getting-started-with-diffable-data-source"}]}},"staticQueryHashes":["4097791827"]}